<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help Center | Skinks: Your Local Skill Marketplace</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Configure Tailwind to use Inter font and custom colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'skinks-primary': '#6d28d9', // Deep Violet/Purple
                        'skinks-secondary': '#a78bfa', // Lighter Purple
                        'skinks-accent': '#f472b6', // Pink Accent
                        'skinks-background': '#f9fafb', // Light Gray Background
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        /* Custom Styles */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #a78bfa;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f9fafb;
        }

        /* Scroll Reveal Animation */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .scroll-reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* --- Smooth Accordion Animation Styles --- */
        .accordion-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, opacity 0.3s ease-out, padding 0.3s ease-out;
            padding: 0 0.25rem; /* Corresponds to py-0 px-1 */
        }
        .accordion-content.open {
            opacity: 1;
            max-height: 500px; /* Adjust as needed for content */
            padding: 1rem 0.25rem; /* Corresponds to py-4 px-1 */
        }
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        .accordion-button.open .accordion-icon {
            transform: rotate(180deg);
        }

        /* --- Modal Styles --- */
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: all 0.3s ease;
        }
        /* Hide scrollbar when modal is open */
        body.modal-open {
            overflow: hidden;
        }

        /* Spinner for button loading */
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-skinks-background font-sans text-gray-800">

    <!-- Navigation Bar -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <a href="index.html" class="text-2xl font-bold text-skinks-primary tracking-tight">
                    Skinks
                </a>
                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-6">
                    <a href="index.html" class="text-gray-600 hover:text-skinks-primary transition duration-150">Home</a>
                    <a href="How-It-Works.html" class="text-gray-600 hover:text-skinks-primary transition duration-150">How It Works</a>
                    
                    <a href="find-talent.html" class="text-gray-600 hover:text-skinks-primary transition duration-150">Find Talent</a>
                    
                    <a href="Post-Task.html" class="text-gray-600 hover:text-skinks-primary transition duration-150">Task Hub</a>
                    <a href="About-Us.html" class="text-gray-600 hover:text-skinks-primary transition duration-150">About Us</a>
                    <!-- Active Link -->
                    <a href="help.html" class="text-skinks-primary font-semibold border-b-2 border-skinks-primary pb-1">Help</a>
                </nav>
                <!-- Call to Action Button Container -->
                <div id="desktop-auth-container" class="hidden md:block">
                    <button onclick="handleJoinClick()" class="px-4 py-2 bg-skinks-primary text-white font-semibold rounded-lg shadow-lg hover:bg-skinks-secondary transition duration-300">
                        Join Now
                    </button>
                </div>
                <!-- Mobile Menu Button (Hamburger Icon) -->
                <button id="mobile-menu-button" class="md:hidden p-2 rounded-lg text-gray-700 hover:bg-gray-100 transition duration-150">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Home</a>
                <a href="How-It-Works.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">How It Works</a>
                
                <a href="find-talent.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Find Talent</a>
                <a href="Post-Task.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Task Hub</a>
                <a href="About-Us.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">About Us</a>
                <a href="help.html" class="block px-3 py-2 rounded-md text-base font-medium text-skinks-primary bg-skinks-secondary/10">Help</a>
                <!-- Mobile Auth Button Container -->
                <div id="mobile-auth-container">
                    <button onclick="handleJoinClick()" class="w-full mt-2 px-4 py-2 bg-skinks-primary text-white font-semibold rounded-lg hover:bg-skinks-secondary transition duration-300">
                        Join Now
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area: Help Center -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        
        <!-- Page Header -->
        <div class="text-center mb-12 scroll-reveal">
            <h1 class="text-5xl font-extrabold text-skinks-primary mb-3">Help Center</h1>
            <p class="text-xl text-gray-600">How can we help you today?</p>
        </div>

        <!-- FAQ Section -->
        <div class="bg-white p-6 sm:p-10 rounded-xl shadow-2xl scroll-reveal">
            <h2 class="text-3xl font-bold text-gray-900 mb-8">Frequently Asked Questions (FAQ)</h2>

            <div class="space-y-6" id="faq-accordion">
                <!-- FAQ Item 1 (For Hirers) -->
                <div class="accordion-item border-b border-gray-200 pb-4">
                    <button class="accordion-button flex justify-between items-center w-full cursor-pointer list-none group">
                        <span class="text-lg font-medium text-gray-900 group-hover:text-skinks-primary">How does the 5km hyperlocal radius work?</span>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-skinks-primary accordion-icon"></i>
                    </button>
                    <div class="accordion-content">
                        <p class="text-gray-600 mt-0 leading-relaxed">
                            Our platform is built on a hyperlocal model. When you post a task, we use geo-location to notify only the skilled talent within a 5-kilometer radius of your specified location. This ensures you get fast, local responses from people in your community.
                        </p>
                    </div>
                </div>

                <!-- FAQ Item 2 (For Hirers) -->
                <div class="accordion-item border-b border-gray-200 pb-4">
                    <button class="accordion-button flex justify-between items-center w-full cursor-pointer list-none group">
                        <span class="text-lg font-medium text-gray-900 group-hover:text-skinks-primary">Is it free to post a task?</span>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-skinks-primary accordion-icon"></i>
                    </button>
                    <div class="accordion-content">
                        <p class="text-gray-600 mt-0 leading-relaxed">
                            Yes! It is 100% free to post a task, receive offers from local talent, and chat with them. You only pay for the task itself once you've hired someone and the work is completed to your satisfaction.
                        </p>
                    </div>
                </div>

                <!-- FAQ Item 3 (For Talent) -->
                <div class="accordion-item border-b border-gray-200 pb-4">
                    <button class="accordion-button flex justify-between items-center w-full cursor-pointer list-none group">
                        <span class="text-lg font-medium text-gray-900 group-hover:text-skinks-primary">How do I get hired as a talent?</span>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-skinks-primary accordion-icon"></i>
                    </button>
                    <div class="accordion-content">
                        <p class="text-gray-600 mt-0 leading-relaxed">
                            First, create a strong profile showcasing your skills, experience, and your hourly or fixed rates. When a task is posted in your 5km radius that matches your skills, you'll be notified. You can then send an offer, chat with the hirer to discuss details, and get hired directly through the platform.
                        </p>
                    </div>
                </div>

                <!-- FAQ Item 4 (For Talent) -->
                <div class="accordion-item border-b border-gray-200 pb-4">
                    <button class="accordion-button flex justify-between items-center w-full cursor-pointer list-none group">
                        <span class="text-lg font-medium text-gray-900 group-hover:text-skinks-primary">What is a "Verified Profile" and how do I get one?</span>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-skinks-primary accordion-icon"></i>
                    </button>
                    <div class="accordion-content">
                        <p class="text-gray-600 mt-0 leading-relaxed">
                            A verified profile (coming soon in Phase 2) will have a "Verified" badge, increasing trust with hirers. This will involve a simple check (e.g., ID or skill certification) to confirm your identity and expertise. Verified talent typically gets hired more often.
                        </p>
                    </div>
                </div>

                <!-- FAQ Item 5 (General) -->
                <div class="accordion-item border-b border-gray-200 pb-4">
                    <button class="accordion-button flex justify-between items-center w-full cursor-pointer list-none group">
                        <span class="text-lg font-medium text-gray-900 group-hover:text-skinks-primary">How are payments handled? Are they secure?</span>
                        <i data-lucide="chevron-down" class="w-5 h-5 text-skinks-primary accordion-icon"></i>
                    </button>
                    <div class="accordion-content">
                        <p class="text-gray-600 mt-0 leading-relaxed">
                            Secure payment integration (coming in Phase 2) will be handled directly through the Skinks platform. Hirers will fund the task upon agreement, and the funds will be held securely in escrow. The payment is released to the talent only after the hirer confirms the task is completed successfully.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Us Section -->
        <div class="mt-12 text-center bg-white p-8 rounded-xl shadow-xl scroll-reveal">
            <h3 class="text-2xl font-bold text-gray-900 mb-3">Can't find your answer?</h3>
            <p class="text-gray-600 mb-6">Our support team is here to help. Reach out to us directly for any questions.</p>
            <button onclick="openSupportModal()" class="inline-block px-8 py-3 bg-skinks-accent text-white font-semibold rounded-lg shadow-lg hover:bg-pink-600 transition duration-300">
                Contact Support
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12 mt-16 scroll-reveal">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-2 md:grid-cols-4 gap-8">
            
            <!-- Logo/Brand -->
            <div class="col-span-2 md:col-span-1">
                <h3 class="text-3xl font-bold text-skinks-accent mb-2">Skinks</h3>
                <p class="text-gray-400 text-sm">Your Local Skill Marketplace.</p>
                <p class="text-gray-500 text-xs mt-4">&copy; 2025 Skinks Innovations. All rights reserved.</p>
            </div>

            <!-- Site Map -->
            <div>
                <h4 class="text-lg font-semibold mb-4 text-skinks-secondary">Quick Links</h4>
                <ul class="space-y-2 text-gray-400 text-sm">
                    <li><a href="find-talent.html" class="hover:text-skinks-accent transition duration-150">Find Talent</a></li>
                    <li><a href="Post-Task.html" class="hover:text-skinks-accent transition duration-150">Task Hub</a></li>
                    <li><a href="How-It-Works.html" class="hover:text-skinks-accent transition duration-150">How It Works</a></li>
                    <li><a href="help.html" class="hover:text-skinks-accent transition duration-150">Help Center</a></li>
                </ul>
            </div>

            <!-- Resources -->
            <div>
                <h4 class="text-lg font-semibold mb-4 text-skinks-secondary">About</h4>
                <ul class="space-y-2 text-gray-400 text-sm">
                    <li><a href="About-Us.html" class="hover:text-skinks-accent transition duration-150">About Us</a></li>
                    <li><a href="#" class="hover:text-skinks-accent transition duration-150">Team</a></li>
                    <li><a href="#" class="hover:text-skinks-accent transition duration-150">Careers</a></li>
                    <li><a href="#" class="hover:text-skinks-accent transition duration-150">Terms & Privacy</a></li>
                </ul>
            </div>

            <!-- Contact -->
            <div>
                <h4 class="text-lg font-semibold mb-4 text-skinks-secondary">Contact</h4>
                <p class="text-gray-400 text-sm">Email: support@skinks.com</p>
                <div class="flex space-x-4 mt-4">
                    <a href="#" aria-label="LinkedIn" class="text-gray-400 hover:text-skinks-accent transition duration-150"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                    <a href="#" aria-label="Twitter" class="text-gray-400 hover:text-skinks-accent transition duration-150"><i data-lucide="twitter" class="w-5 h-5"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Support Modal -->
    <div id="support-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden">
        <!-- Backdrop -->
        <div class="modal-backdrop fixed inset-0 bg-black opacity-0" onclick="closeSupportModal()"></div>
        
        <!-- Modal Content -->
        <div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-lg relative z-10 opacity-0 transform scale-95">
            <form id="support-form" class="p-6 sm:p-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-skinks-primary">Contact Support</h3>
                    <button type="button" onclick="closeSupportModal()" class="text-gray-400 hover:text-gray-600">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <!-- Success Message -->
                <div id="support-success" class="hidden p-4 mb-4 bg-green-100 text-green-700 rounded-lg">
                    Your message has been sent! Our team will get back to you shortly.
                </div>

                <!-- Form Fields -->
                <div id="support-fields">
                    <p class="text-gray-600 mb-6">Please fill out the form below and we'll get back to you as soon as possible.</p>
                    <div class="space-y-4">
                        <div>
                            <label for="support-email" class="block text-sm font-medium text-gray-700 mb-1">Your Email</label>
                            <input type="email" id="support-email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-skinks-primary focus:border-transparent outline-none" placeholder="you@example.com">
                        </div>
                        <div>
                            <label for="support-message" class="block text-sm font-medium text-gray-700 mb-1">Your Message</label>
                            <textarea id="support-message" name="message" rows="4" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-skinks-primary focus:border-transparent outline-none" placeholder="How can we help?"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" onclick="closeSupportModal()" class="px-5 py-2 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition duration-150">
                        Cancel
                    </button>
                    <button id="support-submit-button" type="submit" class="px-5 py-2 bg-skinks-primary text-white font-medium rounded-lg shadow-lg hover:bg-skinks-secondary transition duration-300 flex items-center justify-center space-x-2 min-w-[120px]">
                        <span class="button-text">Send Message</span>
                        <div class="spinner hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Firebase SDK Imports -->
    <script type="module">
        // MUST use .js extensions for web module imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, addDoc, collection, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- NEW: Import Supabase Client ---
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

        // --- NEW: Supabase Configuration ---
        const supabaseUrl = "https://zmfnuocezvjwebugnydw.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InptZm51b2NlenZqd2VidWdueWR3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NTQ5NzMsImV4cCI6MjA3MjMzMDk3M30.zby9E2HkMa0H0nIwmxoTgl_2pVlb-91i6yAubSg-mLs";
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        // --- Firebase Configuration ---
        // These global variables are provided by the environment.
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, auth, db;
        let userId;

        // --- Firebase Initialization ---
        async function initFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                setLogLevel('Debug'); // Enable verbose logging

                await auth.authStateReady(); // Wait for auth state to be ready

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else if (!auth.currentUser) {
                    await signInAnonymously(auth);
                }
                
                userId = auth.currentUser.uid;
                console.log("Firebase Initialized. User ID:", userId);

            } catch (error) {
                console.error("Firebase Init Error:", error);
            }
        }
        
        // --- Global App Logic (non-Firebase) ---
        
        // Initialize Lucide icons
        lucide.createIcons();

        // --- UI Element Selectors ---
        const menuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const desktopAuthContainer = document.getElementById('desktop-auth-container');
        const mobileAuthContainer = document.getElementById('mobile-auth-container');

        // --- NEW: Helper Function ---
        function getInitials(name) {
            if (!name) return '?';
            const parts = name.split(' ');
            if (parts.length === 1) return parts[0].charAt(0).toUpperCase();
            return (parts[0].charAt(0) + parts[parts.length - 1].charAt(0)).toUpperCase();
        }

        // --- NEW: Auth State Change Handler ---
        supabaseClient.auth.onAuthStateChange((event, session) => {
            if (session && session.user) {
                // User is logged in
                const user = session.user;
                const name = user.user_metadata?.full_name || 'User';
                const initials = getInitials(name);

                // Update Desktop Header
                if (desktopAuthContainer) {
                    desktopAuthContainer.innerHTML = `
                        <a href="myprofile.html" class="w-10 h-10 bg-skinks-primary text-white flex items-center justify-center rounded-full font-semibold text-sm hover:bg-skinks-secondary transition-colors duration-200" title="My Profile">
                            ${initials}
                        </a>
                    `;
                }
                // Update Mobile Header
                if (mobileAuthContainer) {
                    mobileAuthContainer.innerHTML = `
                        <a href="myprofile.html" class="block px-3 py-2 rounded-md text-base font-medium text-skinks-primary bg-skinks-secondary/10">
                            My Profile
                        </a>
                    `;
                }
            } else {
                // User is logged out
                // Update Desktop Header
                if (desktopAuthContainer) {
                    desktopAuthContainer.innerHTML = `
                        <button onclick="window.location.href='login.html'" class="px-4 py-2 bg-skinks-primary text-white font-semibold rounded-lg shadow-lg hover:bg-skinks-secondary transition duration-300">
                            Join Now
                        </button>
                    `;
                }
                // Update Mobile Header
                if (mobileAuthContainer) {
                    mobileAuthContainer.innerHTML = `
                        <button onclick="window.location.href='login.html'" class="w-full mt-2 px-4 py-2 bg-skinks-primary text-white font-semibold rounded-lg hover:bg-skinks-secondary transition duration-300">
                            Join Now
                        </button>
                    `;
                }
            }
            lucide.createIcons();
        });


        // 1. Mobile Menu Toggle Logic
        menuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

        // 2. Placeholder for Join/Login
        window.handleJoinClick = () => {
            console.log("Join Clicked: Redirecting to login.html");
            window.location.href = 'login.html';
        };

        // 3. Scroll Reveal Animation Logic
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.scroll-reveal').forEach(el => observer.observe(el));

        // 4. Smooth Accordion Logic
        document.querySelectorAll('.accordion-button').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                const wasOpen = content.classList.contains('open');

                // Optional: Close all other accordions
                document.querySelectorAll('.accordion-content.open').forEach(openContent => {
                    if (openContent !== content) {
                        openContent.classList.remove('open');
                        openContent.previousElementSibling.classList.remove('open');
                    }
                });

                // Toggle the clicked one
                content.classList.toggle('open', !wasOpen);
                button.classList.toggle('open', !wasOpen);
            });
        });

        // 5. Support Modal Logic
        const modal = document.getElementById('support-modal');
        const modalBackdrop = modal.querySelector('.modal-backdrop');
        const modalContent = modal.querySelector('.modal-content');
        const supportForm = document.getElementById('support-form');
        const submitButton = document.getElementById('support-submit-button');
        const buttonText = submitButton.querySelector('.button-text');
        const spinner = submitButton.querySelector('.spinner');
        const successMessage = document.getElementById('support-success');
        const formFields = document.getElementById('support-fields');

        window.openSupportModal = () => {
            modal.classList.remove('hidden');
            document.body.classList.add('modal-open');
            // Trigger transition
            setTimeout(() => {
                modalBackdrop.classList.replace('opacity-0', 'opacity-50');
                modalContent.classList.replace('opacity-0', 'opacity-100');
                modalContent.classList.replace('scale-95', 'scale-100');
            }, 10);
            
            // Reset form
            supportForm.reset();
            successMessage.classList.add('hidden');
            formFields.classList.remove('hidden');
            submitButton.disabled = false;
            buttonText.classList.remove('hidden');
            spinner.classList.add('hidden');
        };

        window.closeSupportModal = () => {
            modalBackdrop.classList.replace('opacity-50', 'opacity-0');
            modalContent.classList.replace('opacity-100', 'opacity-0');
            modalContent.classList.replace('scale-100', 'scale-95');
            // Wait for transition to finish before hiding
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.classList.remove('modal-open');
            }, 300);
        };
        
        // 6. Support Form Submission (Backend)
        supportForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!db || !auth.currentUser) {
                console.error("Firebase not ready. Please try again.");
                // We could show a user-facing error here
                return;
            }
            
            // Show loading state
            submitButton.disabled = true;
            buttonText.classList.add('hidden');
            spinner.classList.remove('hidden');

            const email = e.target.email.value;
            const message = e.target.message.value;
            const currentUserId = auth.currentUser.uid;

            try {
                // Save to a private subcollection for the user
                const supportCollectionPath = `/artifacts/${appId}/users/${currentUserId}/support_tickets`;
                const supportCollection = collection(db, supportCollectionPath);
                
                await addDoc(supportCollection, {
                    email: email,
                    message: message,
                    userId: currentUserId,
                    createdAt: serverTimestamp(),
                    status: "new"
                });

                console.log("Support ticket submitted successfully.");
                
                // Show success state
                formFields.classList.add('hidden');
                successMessage.classList.remove('hidden');
                
                // Hide loading state
                submitButton.disabled = false;
                buttonText.classList.remove('hidden');
                spinner.classList.add('hidden');

                // Close modal after 3 seconds
                setTimeout(closeSupportModal, 3000);

            } catch (error) {
                console.error("Error submitting support ticket:", error);
                // Hide loading state
                submitButton.disabled = false;
                buttonText.classList.remove('hidden');
                spinner.classList.add('hidden');
                // We could show an error message to the user here
            }
        });

        // --- Initialize App ---
        // Wait for the DOM to be fully loaded before initializing Firebase
        document.addEventListener('DOMContentLoaded', initFirebase);

    </script>
</body>
</html>
